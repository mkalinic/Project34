"use strict";controllers.Project_controller=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){var ot,it,ft,et,st,rt,ut;n.IGGUsersProjects=[];n.UsersProjects=[];n.Project=null;n.uploadProgressShow=!1;n.init=function(){var u,f,r;n.uploadProgressShow=!1;console.log("NewProject_controller INITED");n.Project=new o;n.Project.ID=-1;y.id>0?(u=y.id,ut(u),f=null,s.GetMyAccount(function(r){if(console.log("GetMyAccount = ",r),f=r,t.rootScope_curentUser=r,t.rootScope_curentUser=r,t.rootScope_username=r.name,f.userType!="IGG"){i.path("/ViewProject/"+u);return}console.log("NewProject_controller  $scope.projectID ",u);o.getById(u,function(i){(console.log(" NewProject_controller Project project ",i),i!=null)&&(n.Project=i,ot(),n.TopImage=n.Project.photo,n.Image=n.TopImage,console.log(" ------------ $scope.TopImage = ",n.TopImage),n.Project.photo=n.Image,n.Project.timeCompleted=t.rootScope_ShowDateTime(n.Project.timeCompleted),st(),new Date>Date_Parse(n.Project.timeCompleted)&&(n.OpenVaultShow=!0))},function(n){console.error(" NewProject_controller Project.getById",n)})},function(){})):(console.log(" NewProject_controller PRAVI SE NOVI PROJEKT "),n.ShowDetails=!1,n.Project.Phases=[],r=new l,r.ID=1,r.IDproject=-1,r.date=new Date,r.name="selection stage",n.Project.Phases.push(r),r=new l,r.ID=2,r.IDproject=-1,r.date=new Date,r.name="award stage",n.Project.Phases.push(r),r=new l,r.ID=3,r.IDproject=-1,r.date=new Date,r.name="market consultation",n.Project.Phases.push(r),r=new l,r.ID=4,r.IDproject=-1,r.date=new Date,r.name="dialogue",n.Project.Phases.push(r));n.AllUsers=[];s.GetAll(function(t){n.AllUsers=t;console.log("-----  $scope.AllUsers ",n.AllUsers)},function(){})};ot=function(){n.Project.UsersProjects==null&&(n.Project.UsersProjects=[]);for(var t=0;t<n.Project.UsersProjects.length;t++)n.Project.UsersProjects[t].userType=="IGG"?n.IGGUsersProjects.push(n.Project.UsersProjects[t]):n.UsersProjects.push(n.Project.UsersProjects[t]);console.log("$scope.IGGUsersProjects ",n.IGGUsersProjects)};n.getUserForThisProjectById=function(t){if(!t||t<=0)return null;if(n.Project.UsersProjects)for(var i=0;i<n.Project.UsersProjects.length;i++)if(n.Project.UsersProjects[i].User.ID==t)return n.Project.UsersProjects[i].User;return null};n.getUserForThisProjectByUsername=function(t){for(var i=0;i<n.Project.UsersProjects.length;i++)if(n.Project.UsersProjects[i].User.username==t)return n.Project.UsersProjects[i].User;return null};n.SendNotificationText=u("translate")("Are you sure you want to send all notifications to all clients involved in this project");n.SendNoticesToPeopleOnProject=function(){n.SendNotificationText=it("Sending in progress");o.SendNoticesToPeopleOnProject(n.Project.ID,function(){it("emails sent succesfully")},function(){it("emails could not be sentr")})};it=function(t){n.SendNotificationText=u("translate")(t)};n.sendingResponseProgressShow=!1;n.SendPostResponse=function(i,r,f){n.SendNotificationText=it("Sending in progress");var e=new w;(e.ID=-1,e.IDproject=n.Project.ID,e.text=i,e.to=n.NewPost.from,(!n.Project.UsersProjects||n.Project.UsersProjects.length<1)&&!confirm(u("translate")("there are no users on this project, are you sure you want to save this post?")))||(e.from=t.rootScope_curentUser.ID,e.definition=f,e.image=r,e.imageSize=n.NewPostImageSize,e.time=new Date,n.sendingResponseProgressShow=!0,o.SendPostResponse(n.Project.ID,e,n.NewPost,function(t){console.log("Project.SendPostResponse  post =",t);it("emails sent succesfully");n.Project.Posts.push(t);e=new w;alert(u("translate")("sent succesfully"));rt();n.sendingResponseProgressShow=!1},function(){it("emails could not be sent")}))};n.setNewPost=function(t){console.log(" $scope.setNewPost note=",t);n.NewPost=t;n.ShowResponseModal=!0};n.getPostImageAddress=function(n){return w.GetImageAddress(n)};n.GetProjectImageAddress=function(n){return o.GetImageAddress(n)};n.GetUser=function(n){return o.GetImageAddress(n)};n.GetuserImageAddress=function(n){return s.GetImageAddress(n)};n.Save=function(){var r,f;if(n.Project.photo=n.Image,n.Project.photoThumbnail=n.Image,n.Project.ID<=0){for(n.Project.UsersProjects=[],console.log(" $scope.Save $scope.IGGUsersProjects = ",n.IGGUsersProjects),console.log(" $scope.Save $scope.UsersProjects = ",n.UsersProjects),r=0;r<n.IGGUsersProjects.length;r++)n.IGGUsersProjects[r].userType="IGG",n.Project.UsersProjects.push(n.IGGUsersProjects[r]);for(r=0;r<n.UsersProjects.length;r++)n.Project.UsersProjects.push(n.UsersProjects[r]);for(r=0;r<n.Project.TextBlocks.length;r++)n.Project.TextBlocks[r].Files.length<1&&(tt(n.Project.TextBlocks,n.Project.TextBlocks[r]),console.log("------- REMOVED FROM ARRAY ",n.Project.TextBlocks[r])),delete n.Project.TextBlocks[r].NewTextBlockFile}n.Project.timeCompleted instanceof Date?console.log("ALREady a date "):(console.log("$scope.Project.timeCompleted ",n.Project.timeCompleted),f=Date_Parse_FromPicker(n.Project.timeCompleted),f&&f.getFullYear()<1970&&(f=Date_Parse(n.Project.timeCompleted)),n.Project.timeCompleted=f);n.Message="";o.save(n.Project,function(r){console.log("project save, project = ",r);n.Project.ID<=0&&i.path("/Project/"+r.ID);n.Project=r;n.Project.timeCompleted=t.rootScope_ShowDateTime(n.Project.timeCompleted);n.TopImage=n.Project.photo;n.Image=n.TopImage;y.id=n.Project.ID;alert(u("translate")("saved succesfully"));console.log(n.Message)},function(n){console.log("project NOT saved, error=",n)})};n.removePhase=function(t){tt(n.Project.Phases,t);console.log("phase removed $scope.Project.Phases =",n.Project.Phases)};n.removeFile=function(t){(console.log("file remove ",t),console.log("$scope.Project ",n.Project),n.Project.TextBlocks)&&(v["delete"](t,function(){for(var i=0;i<n.Project.TextBlocks.length;i++)n.Project.TextBlocks[i].ID==t.IDTextBlock&&(tt(n.Project.TextBlocks[i].Files,t),n.Project.TextBlocks[i].Files.length<1&&(a["delete"](n.Project.TextBlocks[i],function(){},function(){}),tt(n.Project.TextBlocks,n.Project.TextBlocks[i])))},function(){}),console.log("file removed $scope.Project.TextBlocks =",n.Project.TextBlocks))};n.removeTextBlock=function(t){console.log("$scope.removeTextBlock , block = ",t);a["delete"](t,function(){},function(){});tt(n.Project.TextBlocks,t)};n.addTextBlockFile=function(t,i){if((console.log(t),t)&&t.file){t.dateUploaded=new Date;t.dateModified=new Date;t.IDTextBlock=i;t.ID=-1;console.log("addFile textBoxID="+i+" textBlockFile =",t);for(var r=0;r<n.Project.TextBlocks.length;r++)if(n.Project.TextBlocks[r].ID==i){n.Project.TextBlocks[r].Files||(n.Project.TextBlocks[r].Files=[]);n.Project.TextBlocks[r].Files.push(t);a.save(n.Project.TextBlocks[r],function(t){console.log("TextBlock saved");console.log(t);n.Project.TextBlocks[r]=t},function(n){console.error(n)});n.Project.TextBlocks[r].NewTextBlockFile=new v;break}console.log("Project = ",n.Project)}};ft=-1;n.addTextBlock=function(){var t=null;t=new a;t.NewTextBlockFile=new v;t.IDproject=n.Project.ID;t.Files=[];t.text="";t.ID=ft;ft--;t.time=new Date;n.datePickers.push(new nt);n.Project.TextBlocks||(n.Project.TextBlocks=[]);n.Project.TextBlocks.push(t);console.log("  $scope.Project.TextBlocks =",n.Project.TextBlocks)};n.removeMilestone=function(t){console.log("milestone remove ",t);n.Project.ID>0?c["delete"](t,function(){tt(n.Project.Milestones,t);console.log("file removed $scope.Project.TextBlocks =",n.Project.Milestones)},function(){console.error("MILESTONE CAN NOT BE REMOVED")}):tt(n.Project.Milestones,t)};et=-1;n.addMilestone=function(t){n.datePickerSchedule.opened=!1;t.IDproject=n.Project.ID;t.ID=et;et--;console.log("$scope.addMilestone ",t);n.NewMilestone=new c;n.Project.ID>0?c.save(t,function(){n.Project.Milestones||(n.Project.Milestones=[]);n.Project.Milestones.push(t);n.datePickerSchedule.opened=!1},function(){console.error(" $scope.addMilestone   Milestone.save")}):n.Project.Milestones.push(t);n.datePickerSchedule.opened=!1};n.closeProject=function(){confirm(u("translate")("are you sure you want to close this project"))&&o.close(n.Project,function(){console.log("PROJECT CLOSED");i.path("/Project/"+n.Project.ID)},function(){console.error("PROJECT COULD NOT BE CLOSED")})};n.removeProject=function(){confirm(u("translate")("are you sure you want to delete this project"))&&o["delete"](n.Project,function(){console.log("PROJECT REMOVED");i.path("/Admin")},function(){console.error("PROJECT COULD NOT BE CLOSED")})};n.viewProject=function(){i.path("/ViewProject/"+n.Project.ID)};var tt=function(n,t){if(n)for(var i=0;i<n.length;i++)t.ID==n[i].ID&&n.splice(i,1)},ht=function(n,t){if(n)for(var i=0;i<n.length;i++)t==n[i].ID&&n.splice(i,1)},nt=function(){this.today=function(){this.dt=t.rootScope_ShowDateTime(new Date)};this.today();this.showWeeks=!0;this.toggleWeeks=function(){this.showWeeks=!this.showWeeks};this.clear=function(){this.dt=null};this.disabled=function(n,t){return t==="day"&&(n.getDay()===0||n.getDay()===6)};this.toggleMin=function(){this.minDate=this.minDate?null:new Date};this.toggleMin();this.open=function(n){n.preventDefault();n.stopPropagation();this.opened=!0};this.dateOptions={"year-format":"'yy'","starting-day":1,showButtonBar:!1};this.formats=["dd-MM-yyyy","yyyy/MM/dd","shortDate"];this.format=this.formats[0]};n.ShowTime=function(n){return Date_WriteDate(n)};n.ShowDateTime=function(n){return Date_WriteDateTime(n)};n.datePickerGeneral=new nt;n.datePickerGeneral.format="dd-MM-yyyy HH:mm";n.datePickerSchedule=new nt;n.datePickerDownloads=new nt;n.datePickerDownloads2=new nt;n.datePickerUserFrom=new nt;n.datePickerUserFrom.minDate=new Date;n.datePickerUserFrom.maxDate=new Date;n.datePickerUserTo=new nt;n.datePickerUserTo.minDate=new Date;n.datePickerUserTo.maxDate=new Date;n.datePickerEditedUserProjectFrom=new nt;n.datePickerEditedUserProjectTo=new nt;n.datePickerMilestoneForEdit=new nt;n.datePickerMilestoneForEdit.format="dd-MM-yyyy";n.datePickerNotification=new nt;n.datePickerNotification.format="dd-MM-yyyy";n.datePickerNotificationEditMilestone=new nt;n.datePickerNotificationEditMilestone.format="dd-MM-yyyy";n.datePickers=[];st=function(){if(n.Project.TextBlocks){for(var t=0;t<n.Project.TextBlocks.length;t++)n.datePickers.push(new nt);console.log(" $scope.datePickers =",n.datePickers)}};n.log="";n.uploadImage=function(t){var i,r;if(t&&t.length)for(n.uploadProgressShow=!0,i=0;i<t.length;i++)r=t[i],r.$error||p.upload({url:"/Project/UploadImage?projID="+n.Project.ID,data:{username:n.username,file:r}}).then(function(t){k(function(){console.log(" $$$$$$$$$$$$$$$$$$$$ $scope.uploadImage ",t);n.Project.photo=t.data.Data.name;n.Image=n.Project.photo;n.TopImage=n.Image;console.log("++++ $scope.Project.photo = ",n.Project.photo);n.uploadProgressShow=!1})},null,function(t){var i=parseInt(100*t.loaded/t.total);n.uploadProgressPercentage=i;n.log="progress: "+i+"% "+t.config.data.file.name+"\n"+n.log})};n.uploadPostImage=function(t){var u="/Post/UploadImage?postID="+n.NewPost.ID+"&projectID="+n.Project.ID,i,r;if(t&&t.length)for(n.uploadProgressShow=!0,i=0;i<t.length;i++)r=t[i],r.$error||p.upload({url:u+n.Project.ID,data:{username:n.username,file:r}}).then(function(t){k(function(){n.log="file: "+t.config.data.file.name+", Response: "+JSON.stringify(t.data)+"\n"+n.log;console.log(" $$$$$$$$$$$$$$$$$$$$ $scope.uploadPostImage ",t);n.NewPostImage=t.data.Data.name;n.NewPostImageSize=t.data.Data.size;console.log(" $scope.NewPost = ",n.NewPost);n.uploadProgressShow=!1})},null,function(t){var i=parseInt(100*t.loaded/t.total);n.uploadProgressPercentage=i;n.log="progress: "+i+"% "+t.config.data.file.name+"\n"+n.log;console.log("$scope.uploadProgressPercentage = progressPercentage")})};n.NewTextBlockFile=new v;n.uploadTextBlockFile=function(t,i){var r,u;if(URL="/Project/UploadFile?projID=",console.log("----- textBlock =",i),t&&t.length)for(n.uploadProgressShow=!0,r=0;r<t.length;r++)u=t[r],u.$error||p.upload({url:URL+n.Project.ID,data:{username:n.username,file:u}}).then(function(t){k(function(){i.NewTextBlockFile||(i.NewTextBlockFile=new v);i.NewTextBlockFile.file=t.data.Data.name;i.NewTextBlockFile.size=t.data.Data.size;n.uploadProgressShow=!1})},null,function(t){var i=parseInt(100*t.loaded/t.total);n.uploadProgressPercentage=i;n.log="progress: "+i+"% "+t.config.data.file.name+"\n"+n.log})};n.NewUserProject=new h;n.NewUserProject.beganWithProject=new Date;n.NewUserProject.endedWithProject=new Date;n.NewUserProject.endedWithProject.setMonth(n.NewUserProject.beganWithProject.getMonth()+1);n.addUser=function(){var t,i;if(n.Project.ID>0){for(n.NewUserProject.IDproject=n.Project.ID,n.NewUserProject.User=n.getUserForThisProjectById(n.NewUserProject.IDuser),t=0;t<n.UsersProjects.length;t++)if(n.NewUserProject.IDuser==n.UsersProjects[t].IDuser){alert(u("translate")("user already added"));return}o.SendNewUserInProjectMail(n.Project.ID,n.NewUserProject,function(t){n.UsersProjects.push(h.createFromResponse(t));it("emails sent succesfully");n.EditUserProjectShow=!1;rt();$("#Gebruiker").hide()},function(){it("emails could not be sent")})}else{for(t=0;t<n.UsersProjects.length;t++)if(n.NewUserProject.IDuser==n.UsersProjects[t].IDuser){alert(u("translate")("user already added"));return}for(t=0;t<n.AllUsers.length;t++)if(n.AllUsers[t].ID==n.NewUserProject.IDuser){i=new h;i.IDproject=-1;i.IDuser=n.AllUsers[t].ID;i.User=n.AllUsers[t];n.UsersProjects.push(i);break}n.EditUserProjectShow=!1;rt()}};n.EditUserProjectShow=!1;n.EditedUserProject=null;n.editUserProject=function(t){n.EditUserProjectShow=!0;console.log("    $scope.editUserProject userProject =",t);n.EditedUserProject=t};n.deleteEditedUserProject=function(){n.Project.ID>0?h["delete"](n.EditedUserProject,function(){tt(n.UsersProjects,n.EditedUserProject);n.EditUserProjectShow=!1;rt()},function(){}):(tt(n.UsersProjects,n.EditedUserProject),n.EditUserProjectShow=!1,rt())};n.saveEditedUserProject=function(){n.Project.ID>0?h.save(n.EditedUserProject,function(){n.EditUserProjectShow=!1;rt()},function(){}):(n.EditUserProjectShow=!1,rt())};rt=function(){$(".modal").modal("hide")};n.closeProgress=function(){n.uploadProgressShow=!1};n.removeIGGer=function(t){n.Project.ID>0?h["delete"](t,function(){tt(n.IGGUsersProjects,t)},function(){}):tt(n.IGGUsersProjects,t)};n.addIGGerShow=!0;n.NewIGGerID=null;n.addIGGer=function(t){for(var f,r,i=0;i<n.IGGUsersProjects.length;i++)if(n.IGGUsersProjects[i].IDuser==t){alert(u("translate")("The IGG user has already been added, please chose another IGG user"));return}for(f=null,i=0;i<n.AllUsers.length;i++)n.AllUsers[i].ID==t&&(f=n.AllUsers[i]);if(n.Project.ID>0)h.AddIggerToProject(t,n.Project.ID,function(t){n.IGGUsersProjects.push(t);rt()},function(){});else for(i=0;i<n.AllUsers.length;i++)if(n.AllUsers[i].ID==t){r=new h;r.IDproject=-1;r.IDuser=n.AllUsers[i].ID;r.User=n.AllUsers[i];n.IGGUsersProjects.push(r);break}};n.toMegabytes=function(n){return Math.floor(n/1e6)};n.openedvault=[];n.OpenVault=function(){o.OpenVault(n.Project.ID,function(t){var r,i;for(n.openedvault=[],n.openedvault.push({User:t[0].User,files:[]}),n.openedvault[0].files.push(t[0]),r=0,i=1;i<t.length;i++)t[i].User!=t[i-1].User&&(n.openedvault.push({User:t[i].User,files:[]}),r++),n.openedvault[r].files.push(t[i])},function(){})};n.downloadAllFilesForVault=function(){g.Download("","/Project/DownloadAllFilesForVault?projectID="+n.Project.ID+"&language="+t.rootScope_language)};n.downloadSVaultFile=function(n){g.Download("/UPLOADED_FILES/projects/"+n.File)};n.ShowDetails=!0;n.digitalFilingChanged=function(t){t.target.checked?new Date>Date_Parse(n.Project.timeCompleted)&&(n.OpenVaultShow=!0):n.OpenVaultShow=!1};n.timeCompletedChanged=function(n){console.log(n)};n.showPlanning=!1;n.MilestoneForEdit=null;n.editMilestone=function(t){n.showPlanning=!0;n.MilestoneForEdit=t;console.error("editMilestone NOT IMPLEMENTED ",t)};n.saveEditedMilestone=function(n){c.save(n,function(){},function(){})};n.downloadFile=function(n){g.Download(n)};n.getUserById=function(t){for(var i=0;i<n.AllUsers.length;i++)if(n.AllUsers[i].ID==t)return n.AllUsers[i]};n.upItem=function(t,i){for(var r=0;r<n.Checklist.length;r++)n.Checklist[r].ID==t?(n.Checklist[r].itemOrder--,b.save(n.Checklist[r],function(){},function(){})):n.Checklist[r].itemOrder==i-1&&(n.Checklist[r].itemOrder++,b.save(n.Checklist[r],function(){ut(n.Project.ID)},function(){}))};n.downItem=function(t,i){for(var r=0;r<n.Checklist.length;r++)n.Checklist[r].ID==t?(n.Checklist[r].itemOrder++,b.save(n.Checklist[r],function(){},function(){})):n.Checklist[r].itemOrder==i+1&&(n.Checklist[r].itemOrder--,b.save(n.Checklist[r],function(){ut(n.Project.ID)},function(){}))};n.removeChecklistItem=function(t){b.removeItem(t,function(t){ht(n.Checklist,t)},function(){console.error("$scope.removeChecklistItem, ERROR = ",response)})};ut=function(t){b.GetForProject(t,function(t){n.Checklist=t},function(n){console.error("GetChecklistForProject ",n)})};n.showItemChange=[];n.addChecklistItem=function(){for(var t,r=0,i=0;i<n.Checklist.length;i++)n.Checklist[i].itemOrder>r&&(r=n.Checklist[i].itemOrder),n.showItemChange[n.Checklist[i].ID]=!1;t=new b;t.ID=-1;t.item=n.NewChecklistItem;t.itemOrder=r+1;t.projectID=n.Project.ID;n.Checklist.push(t);b.save(t,function(){ut(n.Project.ID);n.NewChecklistItem=""},function(){})};n.showChangeName=function(t,i){for(var r=0;r<1e3;r++)n.showItemChange[r]&&(n.showItemChange[r]=!1);n.showItemChange[i]=!0};n.renameListItem=function(t){for(var i=0;i<n.Checklist.length;i++)n.showItemChange[n.Checklist[i].ID]=!1,n.Checklist[i].ID==t&&b.save(n.Checklist[i],function(){ut(n.Project.ID)},function(){})}};